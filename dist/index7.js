var e=Object.defineProperty,o=Object.getOwnPropertySymbols,t=Object.prototype.hasOwnProperty,n=Object.prototype.propertyIsEnumerable,r=(o,t,n)=>t in o?e(o,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):o[t]=n,l=(e,l)=>{for(var i in l||(l={}))t.call(l,i)&&r(e,i,l[i]);if(o)for(var i of o(l))n.call(l,i)&&r(e,i,l[i]);return e},i=(e,o,t)=>new Promise((n,r)=>{var l=e=>{try{a(t.next(e))}catch(o){r(o)}},i=e=>{try{a(t.throw(e))}catch(o){r(o)}},a=e=>e.done?n(e.value):Promise.resolve(e.value).then(l,i);a((t=t.apply(e,o)).next())});import{defineComponent as a,ref as u,computed as s,watch as c,nextTick as d,onMounted as v,onBeforeUnmount as p,createElementBlock as m,openBlock as f,normalizeClass as g,createCommentVNode as y,withDirectives as h,createElementVNode as w,unref as x,toDisplayString as b,normalizeStyle as k,vShow as B}from"vue";import{u as D,s as C,h as M,m as E,_ as A}from"./exports.js";const T={key:0,class:"d2-block-header flex justify-between items-center px-4 py-2.5 border-b border-gray-400/5",style:{color:"var(--vscode-editor-foreground)","background-color":"var(--vscode-editor-background)"}},j={class:"flex items-center gap-x-2"},O=["aria-label"],F={key:0,xmlns:"http://www.w3.org/2000/svg","aria-hidden":"true",role:"img",width:"1em",height:"1em",viewBox:"0 0 24 24",class:"w-3 h-3"},H={key:1,xmlns:"http://www.w3.org/2000/svg","aria-hidden":"true",role:"img",width:"1em",height:"1em",viewBox:"0 0 24 24",class:"w-3 h-3"},I=["aria-label"],N=["aria-pressed"],L={key:0,class:"d2-source px-4 py-4"},P={class:"d2-code"},R={key:0,class:"d2-error mt-2 text-xs"},S={key:1},_={key:0,class:"d2-source px-4 py-4"},U={class:"d2-code"},X={key:0,class:"d2-error mt-2 text-xs"},Y=["innerHTML"],q={key:0,class:"d2-error px-4 pb-3 text-xs"},$=/* @__PURE__ */A(/* @__PURE__ */a({__name:"D2BlockNode",props:{node:{},maxHeight:{default:"500px"},loading:{type:Boolean,default:!0},isDark:{type:Boolean},progressiveRender:{type:Boolean,default:!0},progressiveIntervalMs:{default:700},themeId:{},darkThemeId:{},showHeader:{type:Boolean,default:!0},showModeToggle:{type:Boolean,default:!0},showCopyButton:{type:Boolean,default:!0},showExportButton:{type:Boolean,default:!0},showCollapseButton:{type:Boolean,default:!0}},setup(e){const o=e,{t}=D(),n=u(!1),r=u(!1),a=u(!1),A=u(!1),$=u(null),z=u(!1),V=u(""),G=u(0),J=u(null),K=u(null),Q=s(()=>{var e;return null!=(e=o.node.code)?e:""}),W=s(()=>a.value||!A.value||!V.value),Z=s(()=>!!V.value),ee=s(()=>{if(K.value)return{minHeight:`${K.value}px`}}),oe=s(()=>{if(o.maxHeight)return{maxHeight:"number"==typeof o.maxHeight?`${o.maxHeight}px`:String(o.maxHeight)}}),te="undefined"!=typeof window;let ne=null,re=!1,le=!1,ie=0,ae=null,ue=!1,se=null;const ce={N1:"#E5E7EB",N2:"#CBD5E1",N3:"#94A3B8",N4:"#64748B",N5:"#475569",N6:"#334155",N7:"#0B1220",B1:"#60A5FA",B2:"#3B82F6",B3:"#2563EB",B4:"#1D4ED8",B5:"#1E40AF",B6:"#111827",AA2:"#22D3EE",AA4:"#0EA5E9",AA5:"#0284C7",AB4:"#FBBF24",AB5:"#F59E0B"};function de(e){return!e||e.disabled}function ve(e,t,n="top"){if(de(e.currentTarget))return;const r=e,l=null!=(null==r?void 0:r.clientX)&&null!=(null==r?void 0:r.clientY)?{x:r.clientX,y:r.clientY}:void 0;C(e.currentTarget,t,n,!1,l,o.isDark)}function pe(){M()}function me(e){if(de(e.currentTarget))return;const r=n.value?t("common.copied")||"Copied":t("common.copy")||"Copy",l=e,i=null!=(null==l?void 0:l.clientX)&&null!=(null==l?void 0:l.clientY)?{x:l.clientX,y:l.clientY}:void 0;C(e.currentTarget,r,"top",!1,i,o.isDark)}function fe(){return i(this,null,function*(){try{const e=Q.value;"undefined"!=typeof navigator&&navigator.clipboard&&"function"==typeof navigator.clipboard.writeText&&(yield navigator.clipboard.writeText(e)),n.value=!0,setTimeout(()=>{n.value=!1},1e3)}catch(e){console.error("Copy failed:",e)}})}function ge(){r.value=!r.value}function ye(e){a.value="source"===e}const he=[/javascript:/i,/expression\s*\(/i,/url\s*\(\s*javascript:/i,/@import/i],we=/^(?:https?:|mailto:|tel:|#|\/|data:image\/(?:png|gif|jpe?g|webp);)/i;function xe(e){if(!e)return"";const o=e.trim();return we.test(o)?o:""}function be(){V.value=""}function ke(){return i(this,null,function*(){var e,t,n,r,u;if(!te||le)return;if(o.loading&&!o.progressiveRender)return;const s=Q.value;if(!s)return be(),void($.value=null);const c=++G.value;z.value=!0,$.value=null;try{const d=yield function(){return i(this,null,function*(){if(ne)return ne;const e=yield E();if(!e)return null;if("function"==typeof e){const o=new e;return o&&"function"==typeof o.compile?ne=o:"function"==typeof e.compile&&(ne=e),ne}return(null==e?void 0:e.D2)&&"function"==typeof e.D2?(ne=new e.D2,ne):("function"==typeof e.compile&&(ne=e),ne)})}();if(!d)return A.value=!1,a.value=!0,be(),void($.value="D2 is not available.");if("function"!=typeof d.compile||"function"!=typeof d.render)throw new TypeError("D2 instance is missing compile/render methods.");A.value=!0;const v=yield d.compile(s);if(c!==G.value)return;const p=null!=(e=null==v?void 0:v.diagram)?e:v,m=null!=(n=null!=(t=null==v?void 0:v.renderOptions)?t:null==v?void 0:v.options)?n:{},f=null!=(r=o.themeId)?r:m.themeID,g=null!=(u=o.darkThemeId)?u:m.darkThemeID,y=l({},m);if(y.themeID=o.isDark&&null!=g?g:f,y.darkThemeID=null,y.darkThemeOverrides=null,o.isDark){const e=m.themeOverrides&&"object"==typeof m.themeOverrides?m.themeOverrides:null;y.themeOverrides=l(l({},ce),e||{})}const h=yield d.render(p,y);if(c!==G.value)return;const w=function(e){return e?"string"==typeof e?e:"string"==typeof e.svg?e.svg:"string"==typeof e.data?e.data:"":""}(h);if(!w)throw new Error("D2 render returned empty output.");!function(e){const o=function(e){if("undefined"==typeof window||"undefined"==typeof DOMParser)return"";if(!e)return"";const o=e.replace(/["']\s*javascript:/gi,"#").replace(/\bjavascript:/gi,"#").replace(/["']\s*vbscript:/gi,"#").replace(/\bvbscript:/gi,"#").replace(/\bdata:text\/html/gi,"#"),t=(new DOMParser).parseFromString(o,"image/svg+xml").documentElement;if(!t||"svg"!==t.nodeName.toLowerCase())return"";const n=t;return function(e){const o=/* @__PURE__ */new Set(["script"]),t=[e,...Array.from(e.querySelectorAll("*"))];for(const n of t){if(o.has(n.tagName.toLowerCase())){n.remove();continue}const e=Array.from(n.attributes);for(const o of e){const e=o.name;if(/^on/i.test(e))n.removeAttribute(e);else{if("style"===e&&o.value){const t=o.value;if(he.some(e=>e.test(t))){n.removeAttribute(e);continue}}if(("href"===e||"xlink:href"===e)&&o.value){const t=xe(o.value);if(!t){n.removeAttribute(e);continue}t!==o.value&&n.setAttribute(e,t)}}}}}(n),n.outerHTML}(e);V.value=o||""}(w),o.loading&&(a.value=!1),$.value=null}catch(d){if(c!==G.value)return;const e=(null==d?void 0:d.message)?String(d.message):"D2 render failed.";o.loading||($.value=e),e.includes("@terrastruct/d2")&&(A.value=!1,a.value=!0)}finally{c===G.value&&(z.value=!1,ue&&(ue=!1,Be()))}})}function Be(e=!1){if(re)return;if(!te)return;if(le)return;if(z.value)return void(ue=!0);const t=Math.max(120,Number(o.progressiveIntervalMs)||0),n=Date.now()-ie;if(!e&&n<t)return ue=!0,void(null==ae&&(ae=window.setTimeout(()=>{ae=null,ue&&(ue=!1,Be(!0))},Math.max(0,t-n))));re=!0;const r=()=>{re=!1,ie=Date.now(),ke()};"undefined"!=typeof window&&"function"==typeof window.requestAnimationFrame?window.requestAnimationFrame(r):setTimeout(r,0)}function De(){if(V.value)try{const e=new Blob([V.value],{type:"image/svg+xml;charset=utf-8"}),o=URL.createObjectURL(e);if("undefined"!=typeof document){const e=document.createElement("a");e.href=o,e.download=`d2-diagram-${Date.now()}.svg`,document.body.appendChild(e),e.click(),document.body.removeChild(e)}URL.revokeObjectURL(o)}catch(e){console.error("Failed to export SVG:",e)}}function Ce(){const e=J.value;if(!e)return;const o=e.getBoundingClientRect().height;o>0&&(K.value=o)}return c(()=>[o.node.code,o.loading,o.isDark],()=>{Be()},{immediate:!0}),c(()=>o.loading,(e,o)=>{o&&!e&&Be(!0)}),c(()=>[W.value,V.value,Q.value],()=>{d(()=>{Ce()})}),v(()=>{Be(),d(()=>{Ce()}),"undefined"!=typeof ResizeObserver&&(se=new ResizeObserver(()=>{Ce()}),J.value&&se.observe(J.value))}),p(()=>{le=!0,null!=ae&&(clearTimeout(ae),ae=null),null==se||se.disconnect(),se=null}),(e,l)=>(f(),m("div",{class:g(["d2-block-container my-4 rounded-lg border overflow-hidden shadow-sm",o.isDark?"border-gray-700/30 bg-gray-900 text-gray-100":"border-gray-200 bg-white text-gray-900"])},[o.showHeader?(f(),m("div",T,[l[16]||(l[16]=w("div",{class:"flex items-center gap-x-2"},[w("span",{class:"text-sm font-medium font-mono"},"D2")],-1)),w("div",j,[o.showModeToggle?(f(),m("div",{key:0,class:g(["flex items-center gap-x-1 rounded-md p-0.5",o.isDark?"bg-gray-700":"bg-gray-100"])},[w("button",{type:"button",class:g(["mode-btn px-2 py-1 text-xs rounded",a.value?"":"is-active"]),onClick:l[0]||(l[0]=e=>ye("preview")),onMouseenter:l[1]||(l[1]=e=>ve(e,x(t)("common.preview")||"Preview")),onFocus:l[2]||(l[2]=e=>ve(e,x(t)("common.preview")||"Preview")),onMouseleave:pe,onBlur:pe},b(x(t)("common.preview")||"Preview"),35),w("button",{type:"button",class:g(["mode-btn px-2 py-1 text-xs rounded",a.value?"is-active":""]),onClick:l[3]||(l[3]=e=>ye("source")),onMouseenter:l[4]||(l[4]=e=>ve(e,x(t)("common.source")||"Source")),onFocus:l[5]||(l[5]=e=>ve(e,x(t)("common.source")||"Source")),onMouseleave:pe,onBlur:pe},b(x(t)("common.source")||"Source"),35)],2)):y("",!0),o.showCopyButton?(f(),m("button",{key:1,type:"button",class:"d2-action-btn p-2 text-xs rounded-md transition-colors hover:bg-[var(--vscode-editor-selectionBackground)]","aria-label":n.value?x(t)("common.copied")||"Copied":x(t)("common.copy")||"Copy",onClick:fe,onMouseenter:l[6]||(l[6]=e=>me(e)),onFocus:l[7]||(l[7]=e=>me(e)),onMouseleave:pe,onBlur:pe},[n.value?(f(),m("svg",H,[...l[13]||(l[13]=[w("path",{fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M20 6L9 17l-5-5"},null,-1)])])):(f(),m("svg",F,[...l[12]||(l[12]=[w("g",{fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2"},[w("rect",{width:"14",height:"14",x:"8",y:"8",rx:"2",ry:"2"}),w("path",{d:"M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"})],-1)])]))],40,O)):y("",!0),o.showExportButton&&V.value?(f(),m("button",{key:2,type:"button",class:"d2-action-btn p-2 text-xs rounded-md transition-colors hover:bg-[var(--vscode-editor-selectionBackground)]","aria-label":x(t)("common.export")||"Export",onClick:De,onMouseenter:l[8]||(l[8]=e=>ve(e,x(t)("common.export")||"Export")),onFocus:l[9]||(l[9]=e=>ve(e,x(t)("common.export")||"Export")),onMouseleave:pe,onBlur:pe},[...l[14]||(l[14]=[w("svg",{xmlns:"http://www.w3.org/2000/svg","aria-hidden":"true",role:"img",width:"1em",height:"1em",viewBox:"0 0 24 24",class:"w-3 h-3"},[w("path",{fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 3v12m0-12l-4 4m4-4l4 4M4 14v4a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2v-4"})],-1)])],40,I)):y("",!0),o.showCollapseButton?(f(),m("button",{key:3,type:"button",class:"d2-action-btn p-2 text-xs rounded-md transition-colors hover:bg-[var(--vscode-editor-selectionBackground)]","aria-pressed":r.value,onClick:ge,onMouseenter:l[10]||(l[10]=e=>ve(e,r.value?x(t)("common.expand")||"Expand":x(t)("common.collapse")||"Collapse")),onFocus:l[11]||(l[11]=e=>ve(e,r.value?x(t)("common.expand")||"Expand":x(t)("common.collapse")||"Collapse")),onMouseleave:pe,onBlur:pe},[(f(),m("svg",{style:k({rotate:r.value?"0deg":"90deg"}),xmlns:"http://www.w3.org/2000/svg","aria-hidden":"true",role:"img",width:"1em",height:"1em",viewBox:"0 0 24 24",class:"w-3 h-3"},[...l[15]||(l[15]=[w("path",{fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"m9 18l6-6l-6-6"},null,-1)])],4))],40,N)):y("",!0)])])):y("",!0),h(w("div",{ref_key:"bodyRef",ref:J,class:"d2-block-body",style:k(ee.value)},[o.loading&&!Z.value?(f(),m("div",L,[w("pre",P,[w("code",null,b(Q.value),1)]),$.value?(f(),m("p",R,b($.value),1)):y("",!0)])):(f(),m("div",S,[W.value?(f(),m("div",_,[w("pre",U,[w("code",null,b(Q.value),1)]),$.value?(f(),m("p",X,b($.value),1)):y("",!0)])):(f(),m("div",{key:1,class:"d2-render",style:k(oe.value)},[w("div",{class:"d2-svg",innerHTML:V.value},null,8,Y),$.value?(f(),m("p",q,b($.value),1)):y("",!0)],4))]))],4),[[B,!r.value]])],2))}}),[["__scopeId","data-v-f9232822"]]);$.install=e=>{e.component($.__name,$)};export{$ as default};
