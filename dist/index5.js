var e=Object.defineProperty,t=Object.defineProperties,l=Object.getOwnPropertyDescriptors,n=Object.getOwnPropertySymbols,o=Object.prototype.hasOwnProperty,r=Object.prototype.propertyIsEnumerable,i=(t,l,n)=>l in t?e(t,l,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[l]=n,a=(e,t)=>{for(var l in t||(t={}))o.call(t,l)&&i(e,l,t[l]);if(n)for(var l of n(t))r.call(t,l)&&i(e,l,t[l]);return e},u=(e,t,l)=>new Promise((n,o)=>{var r=e=>{try{a(l.next(e))}catch(t){o(t)}},i=e=>{try{a(l.throw(e))}catch(t){o(t)}},a=e=>e.done?n(e.value):Promise.resolve(e.value).then(r,i);a((l=l.apply(e,t)).next())});import{defineComponent as s,ref as c,computed as d,watch as v,onBeforeUnmount as m,nextTick as f,onMounted as h,onUnmounted as p,createElementBlock as w,openBlock as g,normalizeClass as y,createCommentVNode as k,withDirectives as x,renderSlot as b,createElementVNode as M,unref as T,toDisplayString as C,normalizeStyle as B,createBlock as D,mergeProps as j,toHandlers as E,Teleport as S,createVNode as O,Transition as P,withCtx as L,withModifiers as $,vShow as z}from"vue";import{u as A,a as F,i as R,s as H,h as _,j as X,k as N,t as Y,_ as Z}from"./exports.js";import{s as I}from"./safeRaf.js";const q={key:0,class:"mermaid-block-header mermaid-header flex justify-between items-center px-4 py-1 border-b"},V={key:0},U={key:1,class:"mermaid-header-title flex items-center overflow-hidden"},W=["src"],G={key:2},K={key:3,class:"mermaid-mode-toggle flex items-center gap-x-1 rounded-md p-0.5"},J={class:"mermaid-mode-btn-content flex items-center"},Q={class:"mermaid-mode-btn-content flex items-center"},ee={key:4},te={key:5,class:"flex items-center gap-x-1"},le=["aria-pressed"],ne={key:0,xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink","aria-hidden":"true",role:"img",width:"1em",height:"1em",viewBox:"0 0 24 24",class:"w-3 h-3"},oe={key:1,xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink","aria-hidden":"true",role:"img",width:"1em",height:"1em",viewBox:"0 0 24 24",class:"w-3 h-3"},re=["disabled"],ie=["disabled"],ae={key:0,xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink","aria-hidden":"true",role:"img",width:"0.75rem",height:"0.75rem",viewBox:"0 0 24 24"},ue={key:1,xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink","aria-hidden":"true",role:"img",width:"0.75rem",height:"0.75rem",viewBox:"0 0 24 24"},se={key:0,class:"mermaid-source-panel p-4"},ce={class:"mermaid-source-code text-sm font-mono whitespace-pre-wrap"},de={key:1,class:"relative"},ve={key:0,class:"absolute top-2 right-2 z-10 rounded-lg"},me={class:"flex items-center gap-2 backdrop-blur rounded-lg"},fe={class:"dialog-panel mermaid-dialog-panel relative w-full h-full max-w-full max-h-full rounded shadow-lg overflow-hidden"},he={class:"absolute top-6 right-6 z-50 flex items-center gap-2"},pe=/* @__PURE__ */Z(/* @__PURE__ */s({__name:"MermaidBlockNode",props:{node:{},maxHeight:{default:"500px"},loading:{type:Boolean,default:!0},isDark:{type:Boolean},workerTimeoutMs:{default:1400},parseTimeoutMs:{default:1800},renderTimeoutMs:{default:2500},fullRenderTimeoutMs:{default:4e3},showHeader:{type:Boolean,default:!0},showModeToggle:{type:Boolean,default:!0},showCopyButton:{type:Boolean,default:!0},showExportButton:{type:Boolean,default:!0},showFullscreenButton:{type:Boolean,default:!0},showCollapseButton:{type:Boolean,default:!0},showZoomControls:{type:Boolean,default:!0},enableWheelZoom:{type:Boolean,default:!1},isStrict:{type:Boolean,default:!1}},emits:["copy","export","openModal","toggleMode"],setup(e,{emit:n}){var o,r;const i=e,s=n,Z={USE_PROFILES:{svg:!0},FORBID_TAGS:["script"],FORBID_ATTR:[/^on/i],ADD_TAGS:["style"],ADD_ATTR:["style"],SAFE_FOR_TEMPLATES:!0},pe=c(!1),we=d(()=>i.isStrict?"strict":"loose"),ge=d(()=>({startOnLoad:!1,securityLevel:we.value,dompurifyConfig:"strict"===we.value?Z:void 0,flowchart:"strict"===we.value?{htmlLabels:!1}:void 0})),ye=[/javascript:/i,/expression\s*\(/i,/url\s*\(\s*javascript:/i,/@import/i],ke=/^(?:https?:|mailto:|tel:|#|\/|data:image\/(?:png|gif|jpe?g|webp);)/i;function xe(e){if(!e)return"";const t=e.trim();return ke.test(t)?t:""}function be(e){if(e)try{e.replaceChildren()}catch(t){e.innerHTML=""}}function Me(e,t){if(!e)return"";if("strict"===we.value)return function(e,t){if(!e)return"";try{e.replaceChildren()}catch(n){e.innerHTML=""}const l=function(e){if("undefined"==typeof window||"undefined"==typeof DOMParser)return null;if(!e)return null;const t=e.replace(/["']\s*javascript:/gi,"#").replace(/\bjavascript:/gi,"#").replace(/["']\s*vbscript:/gi,"#").replace(/\bvbscript:/gi,"#").replace(/\bdata:text\/html/gi,"#"),l=(new DOMParser).parseFromString(t,"image/svg+xml").documentElement;if(!l||"svg"!==l.nodeName.toLowerCase())return null;const n=l;return function(e){const t=/* @__PURE__ */new Set(["script"]),l=[e,...Array.from(e.querySelectorAll("*"))];for(const n of l){if(t.has(n.tagName.toLowerCase())){n.remove();continue}const e=Array.from(n.attributes);for(const t of e){const e=t.name;if(/^on/i.test(e))n.removeAttribute(e);else{if("style"===e&&t.value){const l=t.value;if(ye.some(e=>e.test(l))){n.removeAttribute(e);continue}}if(("href"===e||"xlink:href"===e)&&t.value){const l=xe(t.value);if(!l){n.removeAttribute(e);continue}l!==t.value&&n.setAttribute(e,l)}}}}}(n),n}(t);return l?(e.appendChild(l),e.innerHTML):""}(e,t);try{e.replaceChildren()}catch(l){e.innerHTML=""}if(t)try{e.insertAdjacentHTML("afterbegin",t)}catch(l){e.innerHTML=t}return e.innerHTML}const{t:Te}=A();function Ce(){return u(this,null,function*(){try{const e=yield R();return pe.value=!!e,e}catch(e){throw pe.value=!1,e}})}"undefined"!=typeof window&&u(null,null,function*(){var e;try{const t=yield Ce();if(!t)return;null==(e=null==t?void 0:t.initialize)||e.call(t,a({},ge.value))}catch(t){pe.value=!1,console.warn("[markstream-vue] Failed to initialize mermaid renderer. Call enableMermaid() to configure a loader.",t)}});const Be=c(!1),De=c(!1),je=c(),Ee=c(),Se=c(),Oe=c(null),Pe=F(),Le=c(null),$e=c("undefined"==typeof window),ze=c(),Ae=d(()=>i.node.code.replace(/\]::([^:])/g,"]:::$1").replace(/:::subgraphNode$/gm,"::subgraphNode")),Fe=c(1),Re=c(0),He=c(0),_e=c(!1),Xe=c({x:0,y:0}),Ne=c(!1),Ye=c(!1),Ze=c(!1),Ie=c(null),qe=c(0),Ve=c(!1);let Ue=null,We=null,Ge=0;const Ke=null!=(o=globalThis.requestIdleCallback)?o:(e,t)=>setTimeout(()=>e({didTimeout:!0}),16),Je=function(){let e=null;return(...t)=>{e&&clearTimeout(e),e=setTimeout(()=>(()=>{Ke(()=>{Jt()},{timeout:500})})(...t),300)}}();function Qe(){null!=We&&(globalThis.clearTimeout(We),We=null)}function et(e=600){if("undefined"==typeof globalThis)return;const t=Math.max(0,e);Qe(),We=globalThis.setTimeout(()=>{We=null,i.loading||Ze.value||!$e.value?et(Math.min(1200,Math.max(300,1.2*t))):Je()},t)}const tt=c("360px");let lt=null;const nt=c(!1),ot=c(!1),rt=c({}),it=c(null),at=c(""),ut=c(0);let st=null;const ct=c(!1),dt=c({zoom:1,translateX:0,translateY:0,containerHeight:"360px"}),vt=d(()=>i.enableWheelZoom||zt.value?{wheel:It}:{}),mt=d(()=>{var e,t,l,n;return{worker:null!=(e=i.workerTimeoutMs)?e:1400,parse:null!=(t=i.parseTimeoutMs)?t:1800,render:null!=(l=i.renderTimeoutMs)?l:2500,fullRender:null!=(n=i.fullRenderTimeoutMs)?n:4e3}}),ft=null!=(r=globalThis.cancelIdleCallback)?r:e=>clearTimeout(e);let ht=null,pt=null,wt=!1,gt=800,yt=null,kt=0,xt=!0,bt=0;function Mt(e,t){const l=null==t?void 0:t.timeoutMs,n=null==t?void 0:t.signal;if(null==n?void 0:n.aborted)return Promise.reject(new DOMException("Aborted","AbortError"));let o=null,r=!1,i=null;return new Promise((t,a)=>{const u=()=>{null!=o&&clearTimeout(o),i&&n&&n.removeEventListener("abort",i)};l&&l>0&&(o=globalThis.setTimeout(()=>{r||(r=!0,u(),a(new Error("Operation timed out")))},l)),n&&(i=()=>{r||(r=!0,u(),a(new DOMException("Aborted","AbortError")))},n.addEventListener("abort",i)),e().then(e=>{r||(r=!0,u(),t(e))}).catch(e=>{r||(r=!0,u(),a(e))})})}function Tt(e){if("undefined"==typeof document)return;if(!Ee.value)return;const t=document.createElement("div");t.className="p-4",t.style.color="var(--color-destructive, oklch(0.577 0.245 27.325))",t.textContent="Failed to render diagram: ";const l=document.createElement("span");l.textContent=e instanceof Error?e.message:"Unknown error",t.appendChild(l),be(Ee.value),Ee.value.appendChild(t),tt.value="360px",ct.value=!0,Qt()}function Ct(e){return!e||e.disabled}function Bt(e,t,l="top"){if(Ct(e.currentTarget))return;const n=e,o=null!=(null==n?void 0:n.clientX)&&null!=(null==n?void 0:n.clientY)?{x:n.clientX,y:n.clientY}:void 0;H(e.currentTarget,t,l,!1,o,i.isDark)}function Dt(){_()}function jt(e){if(Ct(e.currentTarget))return;const t=Be.value?Te("common.copied")||"Copied":Te("common.copy")||"Copy",l=e,n=null!=(null==l?void 0:l.clientX)&&null!=(null==l?void 0:l.clientY)?{x:l.clientX,y:l.clientY}:void 0;H(e.currentTarget,t,"top",!1,n,i.isDark)}function Et(e,t){const l=`%%{init: {"theme": "${"dark"===t?"dark":"default"}"}}%%\n`;return e.trimStart().startsWith("%%{")?e:l+e}function St(){return xt&&!Ne.value&&!nt.value&&!ct.value}function Ot(e){const t=e.split(/\r?\n/);for(;t.length>0;){const e=t[t.length-1].trimEnd();if(""!==e){if(!(/^[-=~>|<\s]+$/.test(e.trim())||/(?:--|==|~~|->|<-|-\||-\)|-x|o-|\|-|\.-)\s*$/.test(e)||/[-|><]$/.test(e)||/(?:graph|flowchart|sequenceDiagram|classDiagram|stateDiagram|erDiagram|gantt)\s*$/i.test(e)))break;t.pop()}else t.pop()}return t.join("\n")}function Pt(e,t,l){return u(this,null,function*(){var n;try{return yield X(e,t,null!=(n=null==l?void 0:l.timeoutMs)?n:mt.value.worker)}catch(o){return yield function(e,t,l){return u(this,null,function*(){var n,o;const r=yield Ce();if(!r)return;const i=r,a=Et(e,t);if("function"==typeof i.parse)return yield Mt(()=>i.parse(a),{timeoutMs:null!=(n=null==l?void 0:l.timeoutMs)?n:mt.value.parse,signal:null==l?void 0:l.signal}),!0;const u=`mermaid-parse-${Math.random().toString(36).slice(2,9)}`;return yield Mt(()=>r.render(u,a),{timeoutMs:null!=(o=null==l?void 0:l.timeoutMs)?o:mt.value.render,signal:null==l?void 0:l.signal}),!0})}(e,t,l)}})}"undefined"!=typeof window&&v(()=>je.value,e=>{var t;if(null==(t=Le.value)||t.destroy(),Le.value=null,!e)return void($e.value=!1);const l=Pe(e,{rootMargin:"400px"});Le.value=l,$e.value=l.isVisible.value,l.whenVisible.then(()=>{$e.value=!0})},{immediate:!0}),m(()=>{var e;null==(e=Le.value)||e.destroy(),Le.value=null});const Lt=d(()=>Ne.value||Ze.value||De.value);function $t(e){if(!je.value||!Ee.value)return;const t=Ee.value.querySelector("svg");if(!t)return;let l=0,n=0;const o=t.getAttribute("viewBox"),r=t.getAttribute("width"),i=t.getAttribute("height");if(o){const e=o.split(" ");4===e.length&&(l=Number.parseFloat(e[2]),n=Number.parseFloat(e[3]))}if(l&&n||r&&i&&(l=Number.parseFloat(r),n=Number.parseFloat(i)),Number.isNaN(l)||Number.isNaN(n)||l<=0||n<=0)try{const e=t.getBBox();e&&e.width>0&&e.height>0&&(l=e.width,n=e.height)}catch(a){return void console.error("Failed to get SVG BBox:",a)}if(l>0&&n>0){const t=n/l;let o=(null!=e?e:je.value.clientWidth)*t;o>n&&(o=n),tt.value=`${o}px`}}const zt=c(!1),At=d(()=>({transform:`translate(${Re.value}px, ${He.value}px) scale(${Fe.value})`}));function Ft(e){"Escape"===e.key&&zt.value&&Rt()}function Rt(){if(zt.value=!1,Se.value&&be(Se.value),Oe.value=null,"undefined"!=typeof document)try{document.body.style.overflow=""}catch(e){}if("undefined"!=typeof window)try{window.removeEventListener("keydown",Ft)}catch(e){}}function Ht(){Fe.value<3&&(Fe.value+=.1)}function _t(){Fe.value>.5&&(Fe.value-=.1)}function Xt(){Fe.value=1,Re.value=0,He.value=0}function Nt(e){_e.value=!0,e instanceof MouseEvent?Xe.value={x:e.clientX-Re.value,y:e.clientY-He.value}:Xe.value={x:e.touches[0].clientX-Re.value,y:e.touches[0].clientY-He.value}}function Yt(e){if(!_e.value)return;let t,l;e instanceof MouseEvent?(t=e.clientX,l=e.clientY):(t=e.touches[0].clientX,l=e.touches[0].clientY),Re.value=t-Xe.value.x,He.value=l-Xe.value.y}function Zt(){_e.value=!1}function It(e){var t;const l=zt.value;if(!i.enableWheelZoom&&!l)return;const n=e.ctrlKey||e.metaKey;if(!l&&!n)return;e.preventDefault();const o=e.currentTarget,r=null!=(t=null!=o?o:Se.value)?t:je.value;if(!r)return;const a=r.getBoundingClientRect(),u=e.clientX-a.left,s=e.clientY-a.top,c=u-a.width/2,d=s-a.height/2,v=(c-Re.value)/Fe.value,m=(d-He.value)/Fe.value,f=.1*(e.deltaY<0?1:-1),h=Math.min(Math.max(Fe.value+f,.5),3);h!==Fe.value&&(Re.value=c-v*h,He.value=d-m*h,Fe.value=h)}function qt(){return u(this,null,function*(){try{const e=Ae.value,t={payload:{type:"copy",text:e},defaultPrevented:!1,preventDefault(){this.defaultPrevented=!0}};if(s("copy",t),t.defaultPrevented)return;"undefined"!=typeof navigator&&navigator.clipboard&&"function"==typeof navigator.clipboard.writeText&&(yield navigator.clipboard.writeText(e)),Be.value=!0,setTimeout(()=>{Be.value=!1},1e3)}catch(e){console.error("Failed to copy:",e)}})}function Vt(){var e;const t=null==(e=Ee.value)?void 0:e.querySelector("svg");if(!t)return void console.error("SVG element not found");const l=(new XMLSerializer).serializeToString(t),n={payload:{type:"export"},defaultPrevented:!1,preventDefault(){this.defaultPrevented=!0},svgElement:t,svgString:l};s("export",n),n.defaultPrevented||function(e,t=null){u(this,null,function*(){try{const n=null!=t?t:(new XMLSerializer).serializeToString(e),o=new Blob([n],{type:"image/svg+xml;charset=utf-8"}),r=URL.createObjectURL(o);if("undefined"!=typeof document){const e=document.createElement("a");e.href=r,e.download=`mermaid-diagram-${Date.now()}.svg`;try{document.body.appendChild(e),e.click(),document.body.removeChild(e)}catch(l){}URL.revokeObjectURL(r)}}catch(n){console.error("Failed to export SVG:",n)}})}(t,l)}function Ut(){var e,t;const l=null!=(t=null==(e=Ee.value)?void 0:e.querySelector("svg"))?t:null,n=l?(new XMLSerializer).serializeToString(l):null,o={payload:{type:"open-modal"},defaultPrevented:!1,preventDefault(){this.defaultPrevented=!0},svgElement:l,svgString:n};s("openModal",o),o.defaultPrevented||function(){if(zt.value=!0,"undefined"!=typeof document)try{document.body.style.overflow="hidden"}catch(e){}if("undefined"!=typeof window)try{window.addEventListener("keydown",Ft)}catch(e){}f(()=>{if(je.value&&Se.value){const e=je.value.cloneNode(!0);e.classList.add("fullscreen");const t=e.querySelector("[data-mermaid-wrapper]");t&&(Oe.value=t,t.style.transform=At.value.transform),be(Se.value),Se.value.appendChild(e)}})}()}function Wt(e){const t={payload:{type:"toggle-mode",target:e},defaultPrevented:!1,preventDefault(){this.defaultPrevented=!0}};s("toggleMode",e,t),t.defaultPrevented||Gt(e)}function Gt(e){return u(this,null,function*(){const t=ze.value;if(!t)return Ye.value=!0,void(Ne.value="source"===e);const l=t.getBoundingClientRect().height;t.style.height=`${l}px`,t.style.overflow="hidden",Ye.value=!0,Ne.value="source"===e,yield f();const n=t.scrollHeight;t.style.transition="height 180ms ease",t.offsetHeight,t.style.height=`${n}px`;const o=()=>{t.style.transition="",t.style.height="",t.style.overflow="",t.removeEventListener("transitionend",r)};function r(){o()}t.addEventListener("transitionend",r),setTimeout(()=>o(),220)})}function Kt(){return u(this,null,function*(){return Ze.value?Ie.value:Ee.value||(yield f(),Ee.value)?(Ze.value=!0,Ie.value=u(null,null,function*(){var e,n,o;Ee.value&&(Ee.value.style.opacity="0");try{const r=yield Ce();if(!r)return;const u=`mermaid-${Date.now()}-${Math.random().toString(36).substring(2,11)}`;nt.value||ot.value||null==(e=r.initialize)||e.call(r,(n=a({},ge.value),o={dompurifyConfig:a({},Z)},t(n,l(o))));const s=function(e,t=Ae.value){const l=t,n=`%%{init: {"theme": "${"dark"===e?"dark":"default"}"}}%%\n`;return l.trim().startsWith("%%{")?l:n+l}(i.isDark?"dark":"light"),c=yield Mt(()=>r.render(u,s),{timeoutMs:mt.value.fullRender}),d=null==c?void 0:c.svg;if(Ee.value){const e=Me(Ee.value,d);nt.value||ot.value||($t(),nt.value=!0,dt.value={zoom:Fe.value,translateX:Re.value,translateY:He.value,containerHeight:tt.value});const t=i.isDark?"dark":"light";e&&(rt.value[t]=e),ot.value&&(ot.value=!1),ct.value=!1,Ge=0,Qe()}}catch(r){const e=function(e){const t="string"==typeof e?e:"string"==typeof(null==e?void 0:e.message)?e.message:"";return"string"==typeof t&&/timed out/i.test(t)}(r),t=Ge+1;e&&t<=3?(Ge=t,et(Math.min(1200,600*t))):(Ge=0,Qe(),console.error("Failed to render mermaid diagram:",r),!1===i.loading&&Tt(r))}finally{yield f(),Ee.value&&(Ee.value.style.opacity="1"),Ze.value=!1,Ie.value=null}}),Ie.value):void console.warn("Mermaid container not ready")})}function Jt(){return u(this,null,function*(){var e,t;const l=Date.now(),n=++ut.value;st&&st.abort(),st=new AbortController;const o=st.signal,r=i.isDark?"dark":"light",a=Ae.value,s=a.replace(/\s+/g,"");if(!a.trim())return Ee.value&&be(Ee.value),it.value=null,at.value="",void(ct.value=!1);if(s===at.value)return;try{const c=yield function(e,t,l){return u(this,null,function*(){var n;try{if(yield Pt(e,t,l))return{fullOk:!0,prefixOk:!1}}catch(r){if("AbortError"===(null==r?void 0:r.name))throw r}let o=Ot(e);if(o&&o.trim()&&o!==e)try{try{const r=yield N(e,t,null!=(n=null==l?void 0:l.timeoutMs)?n:mt.value.worker);r&&r.trim()&&(o=r)}catch(r){}if(yield Pt(o,t,l))return{fullOk:!1,prefixOk:!0,prefix:o}}catch(r){if("AbortError"===(null==r?void 0:r.name))throw r}return{fullOk:!1,prefixOk:!1}})}(a,r,{signal:o,timeoutMs:mt.value.worker});if(c.fullOk)return yield Kt(),void(ut.value===n&&(it.value=null!=(t=null==(e=Ee.value)?void 0:e.innerHTML)?t:null,at.value=s,ct.value=!1));const d=kt&&l<=kt;if(c.prefixOk&&c.prefix&&St()&&!d)return void(yield function(e){return u(this,null,function*(){if(St()&&(Ee.value||(yield f(),Ee.value))&&!Ze.value){Ze.value=!0;try{const t=yield Ce();if(!t)return;const l=`mermaid-partial-${Date.now()}-${Math.random().toString(36).slice(2,9)}`,n=i.isDark?"dark":"light",o=Ot(e),r=Et(o&&o.trim()?o:e,n);Ee.value&&(Ee.value.style.opacity="0");const a=yield Mt(()=>t.render(l,r),{timeoutMs:mt.value.render}),u=null==a?void 0:a.svg;Ee.value&&u&&(Me(Ee.value,u),$t())}catch(t){}finally{yield f(),Ee.value&&(Ee.value.style.opacity="1"),Ze.value=!1}}})}(c.prefix))}catch(d){if("AbortError"===(null==d?void 0:d.name))return}if(ut.value!==n)return;if(ct.value)return;const c=rt.value[r];c&&Ee.value&&Me(Ee.value,c)})}function Qt(){wt&&(wt=!1,gt=800,xt=!1,yt&&(yt.abort(),yt=null),ht&&(globalThis.clearTimeout(ht),ht=null),pt&&(ft(pt),pt=null),kt=Date.now())}function el(){if(Qt(),st){try{st.abort()}catch(e){}st=null}if(yt){try{yt.abort()}catch(e){}yt=null}Y(),Qe(),Ge=0}function tl(e=800){wt&&(bt>=12?Qt():(ht&&globalThis.clearTimeout(ht),ht=globalThis.setTimeout(()=>{pt=Ke(()=>u(null,null,function*(){if(!wt)return;if(Ne.value||nt.value)return void Qt();const e=i.isDark?"dark":"light",t=Ae.value;if(!t.trim())return!1===i.loading?void Qt():void tl(gt);if(bt++,bt>12)Qt();else{yt&&yt.abort(),yt=new AbortController;try{if((yield Pt(t,e,{signal:yt.signal,timeoutMs:mt.value.worker}))&&(yield Kt(),nt.value))return void Qt()}catch(l){}gt=Math.min(Math.floor(1.5*gt),4e3),tl(gt)}}),{timeout:500})},e)))}function ll(){wt||Ne.value||nt.value||(wt=!0,kt=0,xt=!0,bt=0,tl(500))}v(At,e=>{zt.value&&Oe.value&&(Oe.value.style.transform=e.transform)},{immediate:!0}),v(()=>Ae.value,()=>{nt.value=!1,rt.value={},Je(),!Ne.value&&pe.value&&ll(),function(){if(!Ne.value)return;if(!pe.value)return;const e=Ae.value.length;e!==qe.value&&(Ve.value=!0,qe.value=e,Ue&&clearTimeout(Ue),Ue=setTimeout(()=>{Ve.value&&Ne.value&&Ae.value.trim()&&(Ve.value=!1,Gt("preview"))},500))}()}),v(()=>i.isDark,()=>u(null,null,function*(){if(!nt.value)return;if(ct.value)return;const e=i.isDark?"dark":"light",t=rt.value[e];if(t)return void(Ee.value&&Me(Ee.value,t));const l={zoom:Fe.value,translateX:Re.value,translateY:He.value,containerHeight:tt.value},n=1!==Fe.value||0!==Re.value||0!==He.value;ot.value=!0,n&&(Fe.value=1,Re.value=0,He.value=0,yield f()),yield Kt(),n&&(yield f(),Fe.value=l.zoom,Re.value=l.translateX,He.value=l.translateY,tt.value=l.containerHeight,dt.value=l)})),v(()=>Ne.value,e=>u(null,null,function*(){if(e)Qt(),nt.value&&(dt.value={zoom:Fe.value,translateX:Re.value,translateY:He.value,containerHeight:tt.value});else{if(ct.value)return;const e=i.isDark?"dark":"light";if(nt.value&&rt.value[e])return yield f(),Ee.value&&Me(Ee.value,rt.value[e]),Fe.value=dt.value.zoom,Re.value=dt.value.translateX,He.value=dt.value.translateY,void(tt.value=dt.value.containerHeight);if(yield f(),!pe.value)return;yield Jt(),ll()}})),v(()=>i.loading,(e,t)=>u(null,null,function*(){if(!0===t&&!1===e){const e=Ae.value.trim();if(!e)return el();const t=i.isDark?"dark":"light",n=e.replace(/\s+/g,"");if(nt.value&&n===at.value)return yield f(),Ee.value&&!Ee.value.querySelector("svg")&&rt.value[t]&&Me(Ee.value,rt.value[t]),void el();try{yield Pt(e,t,{timeoutMs:mt.value.worker}),yield Kt(),at.value=n,ct.value=!1,el()}catch(l){el(),Tt(l)}}})),v(je,e=>{lt&&lt.disconnect(),!e||nt.value||ot.value||(lt=new ResizeObserver(e=>{e&&e.length>0&&!nt.value&&!ot.value&&I(()=>{$t(e[0].contentRect.width)})}),lt.observe(e))},{immediate:!0}),h(()=>u(null,null,function*(){yield f(),Ye.value||(Ne.value=!pe.value),$e.value&&(Je(),qe.value=Ae.value.length)})),v(()=>pe.value,e=>{Ye.value||(Ne.value=!e)}),v(()=>$e.value,e=>{e&&(nt.value||(Je(),qe.value=Ae.value.length),i.loading||nt.value||Je())},{immediate:!1}),p(()=>{Ue&&clearTimeout(Ue),lt&&lt.disconnect(),st&&(st.abort(),st=null),Y(),Qt(),Qe()}),v(()=>De.value,e=>u(null,null,function*(){e?(Qt(),st&&st.abort()):nt.value||(yield f(),Je(),Ne.value||ll())}),{immediate:!1});const nl=d(()=>"mermaid-action-btn p-2 text-xs rounded");return(e,t)=>(g(),w("div",{class:y(["markstream-mermaid-block my-4 rounded-lg border overflow-hidden shadow-sm",[{"is-dark":i.isDark},{"is-rendering":i.loading}]])},[i.showHeader?(g(),w("div",q,[e.$slots["header-left"]?(g(),w("div",V,[b(e.$slots,"header-left",{},void 0,!0)])):(g(),w("div",U,[M("img",{src:T("data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%2016%2016'%20width='16'%20height='16'%3e%3cpath%20fill='none'%20stroke='%23ca9ee6'%20stroke-linecap='round'%20stroke-linejoin='round'%20d='M1.5%202.5c0%206%202.25%205.75%204%207%20.83.67%201.17%202%201%204h3c-.17-2%20.17-3.33%201-4%201.75-1.25%204-1%204-7C12%202.5%2010%203%208%207%206%203%204%202.5%201.5%202.5'%20/%3e%3c/svg%3e"),class:"w-4 h-4 my-0",alt:"Mermaid"},null,8,W),t[21]||(t[21]=M("span",{class:"mermaid-title text-sm font-medium font-mono truncate"},"Mermaid",-1))])),e.$slots["header-center"]?(g(),w("div",G,[b(e.$slots,"header-center",{},void 0,!0)])):i.showModeToggle&&pe.value?(g(),w("div",K,[M("button",{class:y(["mermaid-mode-btn px-2.5 py-1 text-xs rounded transition-colors",{"is-active":!Ne.value}]),onClick:t[0]||(t[0]=()=>Wt("preview")),onMouseenter:t[1]||(t[1]=e=>Bt(e,T(Te)("common.preview")||"Preview")),onFocus:t[2]||(t[2]=e=>Bt(e,T(Te)("common.preview")||"Preview")),onMouseleave:Dt,onBlur:Dt},[M("div",J,[t[22]||(t[22]=M("svg",{xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink","aria-hidden":"true",role:"img",width:"1em",height:"1em",viewBox:"0 0 24 24",class:"w-3 h-3"},[M("g",{fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2"},[M("path",{d:"M2.062 12.348a1 1 0 0 1 0-.696a10.75 10.75 0 0 1 19.876 0a1 1 0 0 1 0 .696a10.75 10.75 0 0 1-19.876 0"}),M("circle",{cx:"12",cy:"12",r:"3"})])],-1)),M("span",null,C(T(Te)("common.preview")||"Preview"),1)])],34),M("button",{class:y(["mermaid-mode-btn px-2.5 py-1 text-xs rounded transition-colors",{"is-active":Ne.value}]),onClick:t[3]||(t[3]=()=>Wt("source")),onMouseenter:t[4]||(t[4]=e=>Bt(e,T(Te)("common.source")||"Source")),onFocus:t[5]||(t[5]=e=>Bt(e,T(Te)("common.source")||"Source")),onMouseleave:Dt,onBlur:Dt},[M("div",Q,[t[23]||(t[23]=M("svg",{xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink","aria-hidden":"true",role:"img",width:"1em",height:"1em",viewBox:"0 0 24 24",class:"w-3 h-3"},[M("path",{fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"m16 18l6-6l-6-6M8 6l-6 6l6 6"})],-1)),M("span",null,C(T(Te)("common.source")||"Source"),1)])],34)])):k("",!0),e.$slots["header-right"]?(g(),w("div",ee,[b(e.$slots,"header-right",{},void 0,!0)])):(g(),w("div",te,[i.showCollapseButton?(g(),w("button",{key:0,class:y(nl.value),"aria-pressed":De.value,onClick:t[6]||(t[6]=e=>De.value=!De.value),onMouseenter:t[7]||(t[7]=e=>Bt(e,De.value?T(Te)("common.expand")||"Expand":T(Te)("common.collapse")||"Collapse")),onFocus:t[8]||(t[8]=e=>Bt(e,De.value?T(Te)("common.expand")||"Expand":T(Te)("common.collapse")||"Collapse")),onMouseleave:Dt,onBlur:Dt},[(g(),w("svg",{style:B({rotate:De.value?"0deg":"90deg"}),xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink","aria-hidden":"true",role:"img",width:"1em",height:"1em",viewBox:"0 0 24 24",class:"w-3 h-3"},[...t[24]||(t[24]=[M("path",{fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"m9 18l6-6l-6-6"},null,-1)])],4))],42,le)):k("",!0),i.showCopyButton?(g(),w("button",{key:1,class:y(nl.value),onClick:qt,onMouseenter:t[9]||(t[9]=e=>jt(e)),onFocus:t[10]||(t[10]=e=>jt(e)),onMouseleave:Dt,onBlur:Dt},[Be.value?(g(),w("svg",oe,[...t[26]||(t[26]=[M("path",{fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M20 6L9 17l-5-5"},null,-1)])])):(g(),w("svg",ne,[...t[25]||(t[25]=[M("g",{fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2"},[M("rect",{width:"14",height:"14",x:"8",y:"8",rx:"2",ry:"2"}),M("path",{d:"M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"})],-1)])]))],34)):k("",!0),i.showExportButton&&pe.value?(g(),w("button",{key:2,class:y(`${nl.value} ${Lt.value?"opacity-50 cursor-not-allowed":""}`),disabled:Lt.value,onClick:Vt,onMouseenter:t[11]||(t[11]=e=>Bt(e,T(Te)("common.export")||"Export")),onFocus:t[12]||(t[12]=e=>Bt(e,T(Te)("common.export")||"Export")),onMouseleave:Dt,onBlur:Dt},[...t[27]||(t[27]=[M("svg",{xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink","aria-hidden":"true",role:"img",width:"1em",height:"1em",viewBox:"0 0 24 24",class:"w-3 h-3"},[M("g",{fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2"},[M("path",{d:"M12 15V3m9 12v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"}),M("path",{d:"m7 10l5 5l5-5"})])],-1)])],42,re)):k("",!0),i.showFullscreenButton&&pe.value?(g(),w("button",{key:3,class:y(`${nl.value} ${Lt.value?"opacity-50 cursor-not-allowed":""}`),disabled:Lt.value,onClick:Ut,onMouseenter:t[13]||(t[13]=e=>Bt(e,zt.value?T(Te)("common.minimize")||"Minimize":T(Te)("common.open")||"Open")),onFocus:t[14]||(t[14]=e=>Bt(e,zt.value?T(Te)("common.minimize")||"Minimize":T(Te)("common.open")||"Open")),onMouseleave:Dt,onBlur:Dt},[zt.value?(g(),w("svg",ue,[...t[29]||(t[29]=[M("path",{fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"m14 10l7-7m-1 7h-6V4M3 21l7-7m-6 0h6v6"},null,-1)])])):(g(),w("svg",ae,[...t[28]||(t[28]=[M("path",{fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15 3h6v6m0-6l-7 7M3 21l7-7m-1 7H3v-6"},null,-1)])]))],42,ie)):k("",!0)]))])):k("",!0),x(M("div",{ref_key:"modeContainerRef",ref:ze},[Ne.value?(g(),w("div",se,[M("pre",ce,C(Ae.value),1)])):(g(),w("div",de,[i.showZoomControls?(g(),w("div",ve,[M("div",me,[M("button",{class:"mermaid-icon-btn p-2 text-xs rounded transition-colors",onClick:Ht,onMouseenter:t[15]||(t[15]=e=>Bt(e,T(Te)("common.zoomIn")||"Zoom in")),onFocus:t[16]||(t[16]=e=>Bt(e,T(Te)("common.zoomIn")||"Zoom in")),onMouseleave:Dt,onBlur:Dt},[...t[30]||(t[30]=[M("svg",{xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink","aria-hidden":"true",role:"img",width:"1em",height:"1em",viewBox:"0 0 24 24",class:"w-3 h-3"},[M("g",{fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2"},[M("circle",{cx:"11",cy:"11",r:"8"}),M("path",{d:"m21 21l-4.35-4.35M11 8v6m-3-3h6"})])],-1)])],32),M("button",{class:"mermaid-icon-btn p-2 text-xs rounded transition-colors",onClick:_t,onMouseenter:t[17]||(t[17]=e=>Bt(e,T(Te)("common.zoomOut")||"Zoom out")),onFocus:t[18]||(t[18]=e=>Bt(e,T(Te)("common.zoomOut")||"Zoom out")),onMouseleave:Dt,onBlur:Dt},[...t[31]||(t[31]=[M("svg",{xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink","aria-hidden":"true",role:"img",width:"1em",height:"1em",viewBox:"0 0 24 24",class:"w-3 h-3"},[M("g",{fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2"},[M("circle",{cx:"11",cy:"11",r:"8"}),M("path",{d:"m21 21l-4.35-4.35M8 11h6"})])],-1)])],32),M("button",{class:"mermaid-icon-btn p-2 text-xs rounded transition-colors",onClick:Xt,onMouseenter:t[19]||(t[19]=e=>Bt(e,T(Te)("common.resetZoom")||"Reset zoom")),onFocus:t[20]||(t[20]=e=>Bt(e,T(Te)("common.resetZoom")||"Reset zoom")),onMouseleave:Dt,onBlur:Dt},C(Math.round(100*Fe.value))+"% ",33)])])):k("",!0),M("div",j({ref_key:"mermaidContainer",ref:je,class:"mermaid-preview-surface min-h-[360px] relative transition-all duration-100 overflow-hidden block",style:{height:tt.value}},E(vt.value,!0),{onMousedown:Nt,onMousemove:Yt,onMouseup:Zt,onMouseleave:Zt,onTouchstartPassive:Nt,onTouchmovePassive:Yt,onTouchendPassive:Zt}),[M("div",{"data-mermaid-wrapper":"",class:y(["absolute inset-0 cursor-grab",{"cursor-grabbing":_e.value}]),style:B(At.value)},[M("div",{ref_key:"mermaidContent",ref:Ee,class:"_mermaid w-full text-center flex items-center justify-center min-h-full"},null,512)],6)],16),(g(),D(S,{to:"body"},[M("div",{class:y(["markstream-vue mermaid-teleport-root",{"is-dark":i.isDark}])},[O(P,{name:"mermaid-dialog",appear:""},{default:L(()=>[zt.value?(g(),w("div",{key:0,class:"mermaid-dialog-overlay fixed inset-0 z-50 flex items-center justify-center p-4",onClick:$(Rt,["self"])},[M("div",fe,[M("div",he,[M("button",{class:"mermaid-icon-btn p-2 text-xs rounded transition-colors",onClick:Ht},[...t[32]||(t[32]=[M("svg",{xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink","aria-hidden":"true",role:"img",width:"1em",height:"1em",viewBox:"0 0 24 24",class:"w-3 h-3"},[M("g",{fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2"},[M("circle",{cx:"11",cy:"11",r:"8"}),M("path",{d:"m21 21l-4.35-4.35M11 8v6m-3-3h6"})])],-1)])]),M("button",{class:"mermaid-icon-btn p-2 text-xs rounded transition-colors",onClick:_t},[...t[33]||(t[33]=[M("svg",{xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink","aria-hidden":"true",role:"img",width:"1em",height:"1em",viewBox:"0 0 24 24",class:"w-3 h-3"},[M("g",{fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2"},[M("circle",{cx:"11",cy:"11",r:"8"}),M("path",{d:"m21 21l-4.35-4.35M8 11h6"})])],-1)])]),M("button",{class:"mermaid-icon-btn p-2 text-xs rounded transition-colors",onClick:Xt},C(Math.round(100*Fe.value))+"% ",1),M("button",{class:"mermaid-icon-btn inline-flex items-center justify-center p-2 rounded transition-colors",onClick:Rt},[...t[34]||(t[34]=[M("svg",{xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink","aria-hidden":"true",role:"img",width:"1em",height:"1em",viewBox:"0 0 24 24",class:"w-3 h-3"},[M("path",{fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M18 6L6 18M6 6l12 12"})],-1)])])]),M("div",j({ref_key:"modalContent",ref:Se,class:"w-full h-full flex items-center justify-center p-4 overflow-hidden"},E(vt.value,!0),{onMousedown:Nt,onMousemove:Yt,onMouseup:Zt,onMouseleave:Zt,onTouchstartPassive:Nt,onTouchmovePassive:Yt,onTouchendPassive:Zt}),null,16)])])):k("",!0)]),_:1})],2)]))]))],512),[[z,!De.value]])],2))}}),[["__scopeId","data-v-25bf7876"]]);pe.install=e=>{e.component(pe.__name,pe)};export{pe as default};
