var e=(e,n,t)=>new Promise((l,a)=>{var o=e=>{try{u(t.next(e))}catch(n){a(n)}},r=e=>{try{u(t.throw(e))}catch(n){a(n)}},u=e=>e.done?l(e.value):Promise.resolve(e.value).then(o,r);u((t=t.apply(e,n)).next())});import{defineComponent as n,ref as t,watch as l,onMounted as a,onBeforeUnmount as o,createElementBlock as r,openBlock as u,createVNode as i,createElementVNode as d,Transition as c,withCtx as s,createCommentVNode as v,normalizeClass as f}from"vue";import{a as m,d as h,e as p,f as _,W as y,_ as x}from"./exports.js";const w={key:0,class:"math-loading-overlay"},E=/* @__PURE__ */x(/* @__PURE__ */n({__name:"MathBlockNode",props:{node:{}},setup(n){const x=n,E=t(null),R=t(null);let T=!1,g=0,k=!1,b=null;const I=m();let M=null;const O=t(!0);function C(){return e(this,null,function*(){if(!R.value||k)return;if(!x.node.content)return O.value=!1,R.value.textContent=x.node.raw,void(T=!0);if(!T)try{!M&&E.value&&(M=I(E.value)),yield null==M?void 0:M.whenVisible}catch(l){}b&&(b.abort(),b=null);const n=++g,t=new AbortController;b=t,h(x.node.content,!0,{timeout:3e3,waitTimeout:2e3,maxRetries:1,signal:t.signal}).then(e=>{k||n!==g||R.value&&(R.value.innerHTML=e,T=!0,O.value=!1)}).catch(t=>e(null,null,function*(){if(k||n!==g)return;if(!R.value)return;const e=(null==t?void 0:t.code)||(null==t?void 0:t.name),a="KATEX_DISABLED"===e;if("WORKER_INIT_ERROR"===e||(null==t?void 0:t.fallbackToRenderer)||e===y||"WORKER_TIMEOUT"===e){const e=yield p();if(e){try{const n=e.renderToString(x.node.content,{throwOnError:x.node.loading,displayMode:!0});R.value.innerHTML=n,T=!0,O.value=!1,_(x.node.content,!0,n)}catch(l){}return}}if(a)return O.value=!1,void(R.value.textContent=x.node.raw);T||(O.value=!0),x.node.loading||(O.value=!1,R.value.textContent=x.node.raw)}))})}return l(()=>x.node.content,()=>{C()}),a(()=>{C()}),o(()=>{var e;k=!0,b&&(b.abort(),b=null),null==(e=null==M?void 0:M.destroy)||e.call(M),M=null}),(e,n)=>(u(),r("div",{ref_key:"containerEl",ref:E,class:"math-block text-center overflow-x-auto relative min-h-[40px]"},[i(c,{name:"math-fade"},{default:s(()=>[O.value?(u(),r("div",w,[...n[0]||(n[0]=[d("div",{class:"math-loading-spinner"},null,-1)])])):v("",!0)]),_:1}),d("div",{ref_key:"mathBlockElement",ref:R,class:f({"math-rendering":O.value})},null,2)],512))}}),[["__scopeId","data-v-f432e706"]]);E.install=e=>{e.component(E.__name,E)};export{E as default};
